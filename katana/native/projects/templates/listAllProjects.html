{% load static %}
{% load jsonify %}


<script src="https://code.jquery.com/jquery-1.12.4.js"></script>
<script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
<link rel="stylesheet" href="//code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">
<link rel="stylesheet" href="{% static './jquery-ui-1.12.1.custom/jquery-ui.css' %}">
<link rel="stylesheet" href="{% static './table.css' %}">

<script type="text/javascript" src="{% static "./badgerfish.js" %}"></script>
<script type="text/javascript" src="{% static "./json.js" %}"></script>
<script type="text/javascript" src="{% static "./xmlparser.js" %}"></script>
<script type="text/javascript" src="{% static "./doProjectHandling.js" %}"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jstree/3.2.1/jstree.min.js"></script>

    <h2>List of Projects</h2>

<div id="myProject">


</div>
      <div class="btn-group" role="group">   
      <button id="addSuite" class="btn btn-success" onclick="startNewProject()">Add New Project</button>
      </div>
<div id="myProjectTree"></div>
<div id="mmm" >{{treejs|jsonify}}</div>

<script> 

function startNewProject() {
  var xref="./projects/editProject/fname=NEW" ;
  katana.templateAPI.load(xref, null, null, 'NEW') ;
}
//-------------------------------------  [ ] 
katana.$activeTab.find('#mmm').hide();
var sdata= katana.$activeTab.find('#mmm').text();
console.log(sdata);
var jdata = { 'core' : { 'data' : [ JSON.parse(sdata)]}};

katana.$activeTab.find('#myProjectTree').jstree(jdata); 
katana.$activeTab.find('#myProjectTree').on("select_node.jstree", function (e, data) { 
      var thePage = data.node.li_attr['data-path'];
      katana.$view.one('tabAdded', function(){
      mapFullProjectJson(thePage);
  });
  //

  var xref="./projects/editProject/?fname=" + thePage; 
  katana.templateAPI.load(xref, null, null, 'Project') ;


});

</script>

